window.console||(console={log:function(){}});var lowLag=new function(){this.someVariable=void 0,this.showNeedInit=function(){lowLag.msg("lowLag: you must call lowLag.init() first!")},this.load=this.showNeedInit,this.play=this.showNeedInit,this.stop=this.showNeedInit,this.mute=this.showNeedInit,this.unmute=this.showNeedInit,this.audioTagTimeToLive=5e4,this.sm2url="sm2/swf/",this.soundUrl="",this.debug="nope",this.init=function(a){$("#lowLag").remove(),$("body").append("<div id='lowLag'></div>");var b=void 0;void 0!=a&&(void 0!=a.force&&(b=a.force),void 0!=a.audioTagTimeToLive&&(lowLag.audioTagTimeToLive=a.audioTagTimeToLive),void 0!=a.sm2url&&(lowLag.sm2url=a.sm2url),void 0!=a.urlPrefix&&(lowLag.soundUrl=a.urlPrefix),void 0!=a.debug&&(lowLag.debug=a.debug));var c="sm2";switch(void 0!=b?c=b:"undefined"!=typeof window.webkitAudioContext||"undefined"!=typeof window.AudioContext?c="webkitAudio":-1!=navigator.userAgent.indexOf("Firefox")&&(c="audioTag"),c){case"webkitAudio":this.msg("init webkitAudio"),this.load=this.loadSoundWebAudio,this.play=this.playSoundWebAudio,this.stop=this.stopSoundWebAudio,this.mute=this.muteWebAudio,this.unmute=this.unmuteWebAudio,window.AudioContext?this.webkitAudioContext=new AudioContext:window.webkitAudioContext&&(this.webkitAudioContext=new webkitAudioContext),this.webkitGainNode=this.webkitAudioContext.createGain();break;case"audioTag":this.msg("init audioTag"),this.load=this.loadSoundAudioTag,this.play=this.playSoundAudioTag,this.stop=this.stopSoundAudioTag,this.mute=this.muteAudioTag,this.unmute=this.unmuteAudioTag;break;case"sm2":this.msg("init SoundManager2"),this.load=this.loadSoundSM2,this.play=this.playSoundSM2,this.stop=this.stopSoundSM2,this.mute=this.muteSM2,this.unmute=this.unmuteSM2,lowLag.msg("loading SM2 from "+lowLag.sm2url),soundManager.setup({url:lowLag.sm2url,useHighPerformance:!0,onready:lowLag.sm2Ready,debugMode:!1})}return c},this.sm2IsReady=!1,this.sm2ToLoad=[],this.loadSoundSM2=function(a,b){lowLag.sm2IsReady?lowLag.loadSoundSM2ForReals(a,b):lowLag.sm2ToLoad.push([a,b])},this.loadSoundSM2ForReals=function(a,b){var c=lowLag.getTagFromURL(a,b);lowLag.msg("sm2 loading "+a+" as tag "+c);for(var a=lowLag.getURLArray(a),d=0;d<a.length;d++){var e=lowLag.soundUrl+a[d];a[d]=e}soundManager.createSound({id:c,autoLoad:!0,url:a})},this.sm2Ready=function(){lowLag.sm2IsReady=!0;for(var a=0;a<lowLag.sm2ToLoad.length;a++){var b=lowLag.sm2ToLoad[a];lowLag.loadSoundSM2ForReals(b[0],b[1])}lowLag.sm2ToLoad=[]},this.playSoundSM2=function(a,b){lowLag.msg("playSoundSM2 "+a),soundManager.play(a,{onfinish:function(){b&&lowLag.play(a,b)}})},this.stopSoundSM2=function(a){lowLag.msg("stopSoundSM2 "+a),soundManager.stop(a)},this.muteSM2=function(){soundManager.mute()},this.unmuteSM2=function(){soundManager.unmute()},this.getTagFromURL=function(a,b){return void 0!=b?b:lowLag.getSingleURL(a)},this.getSingleURL=function(a){return"string"==typeof a?a:a[0]},this.getURLArray=function(a){return"string"==typeof a?[a]:a},this.webkitPendingRequest={},this.webkitAudioContext=void 0,this.webkitAudioBuffers={},this.webkitGainNode=void 0,this.loadSoundWebAudio=function(a,b){var c=lowLag.getSingleURL(a),b=lowLag.getTagFromURL(a,b);lowLag.msg("webkitAudio loading "+c+" as tag "+b);var d=new XMLHttpRequest;d.open("GET",lowLag.soundUrl+c,!0),d.responseType="arraybuffer",d.onload=function(){lowLag.webkitAudioContext.decodeAudioData(d.response,function(a){lowLag.webkitAudioBuffers[b]=a,lowLag.webkitPendingRequest[b]&&lowLag.playSoundWebAudio(b)},lowLag.errorLoadWebAudtioFile)},d.send()},this.errorLoadWebAudtioFile=function(a){lowLag.msg("Error loading webkitAudio: "+a)},this.sources=[],this.playSoundWebAudio=function(a,b){lowLag.msg("playSoundWebAudio "+a);var c=lowLag.webkitAudioBuffers[a];if(void 0==c)return void(lowLag.webkitPendingRequest[a]=!0);var d=lowLag.webkitAudioContext;this.sources[a]=d.createBufferSource(),this.sources[a].buffer=c,this.sources[a].connect(this.webkitGainNode),this.sources[a].loop=b|!1,this.webkitGainNode.connect(d.destination),this.sources[a].start(0)},this.stopSoundWebAudio=function(a){lowLag.msg("stopSoundWebAudio "+a),this.sources[a]&&this.sources[a].stop(0)},this.muteWebAudio=function(){this.webkitGainNode.gain.value=0},this.unmuteWebAudio=function(){this.webkitGainNode.gain.value=1},this.audioTagID=0,this.audioTagNameToElement={},this.audioTagMuted=!1,this.loadSoundAudioTag=function(a,b){var c="lowLagElem_"+lowLag.audioTagID++,b=lowLag.getTagFromURL(a,b),a=lowLag.getURLArray(a);lowLag.audioTagNameToElement[b]=c,lowLag.msg("audioTag loading "+a+" as tag "+b);var d="";d+='<audio id="'+c+'" preload="auto" autobuffer>';for(var e=0;e<a.length;e++){var f=a[e],g="audio/"+lowLag.getExtension(f);d+='  <source src="'+lowLag.soundUrl+f+'" type="'+g+'" />'}d+="</audio>",$("#lowLag").append(d)},this.playSoundAudioTag=function(a,b){lowLag.msg("playSoundAudioTag "+a);var c=lowLag.audioTagNameToElement[a],d="lowLagCloneElem_"+lowLag.audioTagID++;$("#"+c).clone().attr("id",d).appendTo("#lowLag");var e=document.getElementById(d);lowLag.msg(a),-1==lowLag.audioTagTimeToLive||b||setTimeout(function(){$("#"+d).remove()},lowLag.audioTagTimeToLive),this.audioTagMuted&&(e.muted=!0),e.loop=b|!1,e.play()},this.stopSoundAudioTag=function(a){lowLag.msg("stopSoundAudioTag "+a);for(var b=(lowLag.audioTagNameToElement[a],0);b<lowLag.audioTagID;b++){var c="lowLagCloneElem_"+b,d=$("#"+c).get(0);d&&d.remove()}},this.muteAudioTag=function(){this.audioTagMuted=!0,$("audio").each(function(){this.muted=!0})},this.unmuteAudioTag=function(){this.audioTagMuted=!1,$("audio").each(function(){this.muted=!1})},this.getExtension=function(a){return a.substring(a.lastIndexOf(".")+1).toLowerCase()},this.msg=function(a){a="-- lowLag "+a,"both"==lowLag.debug||"console"==lowLag.debug,("both"==lowLag.debug||"screen"==lowLag.debug)&&$("#lowLag").append(a+"<br>")}};